{
  "project": "nls-finetune-scix",
  "description": "Feature tracking for SciX/ADS fine-tuning. Work on ONE failing feature at a time.",
  "instructions": "Update status to 'passing' ONLY after running 'mise run verify' successfully. Never delete features.",
  "features": [
    {
      "id": "setup-001",
      "name": "Repository initialized with mise",
      "category": "setup",
      "status": "passing",
      "verification": "mise install && python --version && bun --version"
    },
    {
      "id": "setup-002",
      "name": "Python dependencies installed",
      "category": "setup",
      "status": "passing",
      "verification": "cd packages/finetune && uv sync"
    },
    {
      "id": "setup-004",
      "name": "ADS API key configured",
      "category": "setup",
      "status": "passing",
      "verification": "test -n \"$ADS_API_KEY\" && echo 'ADS_API_KEY set'"
    },
    {
      "id": "domain-001",
      "name": "SciX domain module created with field definitions",
      "category": "domain",
      "status": "passing",
      "verification": "python -c \"from finetune.domains.scix.fields import ADS_FIELDS; assert len(ADS_FIELDS) >= 40\""
    },
    {
      "id": "domain-002",
      "name": "ADS query linter works offline",
      "category": "domain",
      "status": "passing",
      "verification": "python -c \"from finetune.domains.scix.validate import lint_query; r = lint_query('author:\\\"Einstein\\\"'); assert r.valid\""
    },
    {
      "id": "domain-003",
      "name": "ADS query validator calls API",
      "category": "domain",
      "status": "passing",
      "verification": "python -c \"from finetune.domains.scix.validate import validate_query; r = validate_query('author:\\\"Einstein\\\"'); print(r)\""
    },
    {
      "id": "domain-004",
      "name": "NL validation detects ADS syntax leakage",
      "category": "domain",
      "status": "passing",
      "verification": "python -c \"from finetune.domains.scix.validate import validate_nl; ok, issues = validate_nl('author:Einstein papers'); assert not ok\""
    },
    {
      "id": "data-001",
      "name": "Curated gold examples JSON created",
      "category": "data",
      "status": "passing",
      "verification": "python -c \"import json; d=json.load(open('data/datasets/raw/gold_examples.json')); assert len(d) >= 50\""
    },
    {
      "id": "data-002",
      "name": "NL generation script updated for ADS",
      "category": "data",
      "status": "passing",
      "verification": "grep -E 'ADS_SYNTAX_MARKERS|finetune.domains.scix.prompts' scripts/generate_nl.py && grep -E 'author:|abs:|pubdate:' scripts/generate_nl.py"
    },
    {
      "id": "data-003",
      "name": "Dataset validation script uses ADS validator",
      "category": "data",
      "status": "passing",
      "verification": "grep -E 'finetune.domains.scix|lint_query' scripts/validate_dataset.py"
    },
    {
      "id": "data-004",
      "name": "Training data JSONL created with 500+ examples",
      "category": "data",
      "status": "passing",
      "verification": "test -f data/datasets/processed/train.jsonl && wc -l < data/datasets/processed/train.jsonl | xargs test 500 -lt"
    },
    {
      "id": "modal-001",
      "name": "Modal train.py syntax valid",
      "category": "modal",
      "status": "passing",
      "verification": "python -m py_compile packages/finetune/src/finetune/modal/train.py"
    },
    {
      "id": "modal-002",
      "name": "LoRA training completed on Qwen3-1.7B",
      "category": "modal",
      "status": "passing",
      "verification": "curl -s https://sjarmak--nls-finetune-serve-vllm-serve.modal.run/health | grep -q 'ok\\|true' || curl -s https://sjarmak--nls-finetune-serve-vllm-serve.modal.run/v1/models | grep -q 'llm'"
    },
    {
      "id": "modal-003",
      "name": "vLLM inference endpoint deployed",
      "category": "modal",
      "status": "passing",
      "verification": "curl -s https://sjarmak--nls-finetune-serve-vllm-serve.modal.run/v1/models | grep -q 'llm'"
    },
    {
      "id": "eval-001",
      "name": "Evaluation module computes result-set overlap",
      "category": "eval",
      "status": "passing",
      "verification": "python -c \"from finetune.domains.scix.eval import compute_overlap_metrics; j, p, r = compute_overlap_metrics(['a','b'], ['b','c']); assert j == 1/3\""
    },
    {
      "id": "eval-002",
      "name": "Syntactic validity rate metric",
      "category": "eval",
      "status": "passing",
      "verification": "python -c \"from finetune.domains.scix.eval import compute_syntax_validity; assert compute_syntax_validity is not None\""
    },
    {
      "id": "eval-003",
      "name": "Feature-sliced reporting (author, pubdate, bibstem, object)",
      "category": "eval",
      "status": "passing",
      "verification": "python -c \"from finetune.domains.scix.eval import evaluate_by_category; assert evaluate_by_category is not None\""
    },
    {
      "id": "integ-001",
      "name": "NL search component added to nectar UI",
      "category": "integration",
      "status": "passing",
      "verification": "test -f ~/ads-dev/nectar/src/components/NLSearch/index.tsx",
      "notes": "Branch: sj/fine-tune in ~/ads-dev/nectar"
    },
    {
      "id": "integ-002",
      "name": "Modal endpoint proxy in nectar API routes",
      "category": "integration",
      "status": "passing",
      "verification": "grep -r 'nls-finetune-serve-vllm' ~/ads-dev/nectar/src/",
      "notes": "Proxy Modal endpoint through Next.js API route"
    },
    {
      "id": "integ-003",
      "name": "Query suggestion display with copy/apply buttons",
      "category": "integration",
      "status": "passing",
      "verification": "grep -r 'copyToClipboard\\|applyQuery' ~/ads-dev/nectar/src/components/NLSearch/",
      "notes": "User can copy suggested query or apply directly to search"
    },
    {
      "id": "integ-004",
      "name": "Preview result count via ADS API",
      "category": "integration",
      "status": "passing",
      "verification": "grep -r 'numFound\\|resultCount' ~/ads-dev/nectar/src/components/NLSearch/",
      "notes": "Show approximate result count for generated query"
    },
    {
      "id": "integ-005",
      "name": "Feature flag for NL search toggle",
      "category": "integration",
      "status": "passing",
      "verification": "grep -r 'NEXT_PUBLIC_NL_SEARCH\\|nlSearchEnabled' ~/ads-dev/nectar/",
      "notes": "Environment variable to enable/disable feature"
    },
    {
      "id": "integ-006",
      "name": "Playwright e2e test for NL search flow",
      "category": "integration",
      "status": "passing",
      "verification": "test -f ~/ads-dev/nectar/e2e/tests/nl-search.spec.ts && cd ~/ads-dev/nectar && pnpm test:e2e --grep 'NL search'",
      "notes": "E2E test covering NL input → query suggestion → apply flow"
    },
    {
      "id": "integ-007",
      "name": "Search API proxy for result count preview",
      "category": "integration",
      "status": "passing",
      "verification": "curl -s 'http://localhost:8000/api/search?q=author:Einstein&rows=0' | grep -q 'numFound'",
      "notes": "Bug: /api/search returns 404. Creates proxy to ADS search API. See beads: nls-finetune-scix-h1y"
    },
    {
      "id": "integ-008",
      "name": "Model inference latency optimization",
      "category": "integration",
      "status": "passing",
      "verification": "time curl -s -X POST https://sjarmak--nls-finetune-serve-vllm-serve.modal.run/v1/chat/completions -H 'Content-Type: application/json' -d '{\"model\":\"llm\",\"messages\":[{\"role\":\"user\",\"content\":\"Query: papers by Einstein\"}],\"max_tokens\":64}' 2>&1 | grep -E 'real.*0m[01]'",
      "notes": "Fixed with min_containers=1. Warm requests ~0.4s. See: nls-finetune-scix-556"
    },
    {
      "id": "eval-004",
      "name": "Model quality - author initial hallucination fix",
      "category": "eval",
      "status": "passing",
      "verification": "grep -q 'stripHallucinatedInitials' ~/ads-dev/nectar/src/pages/api/nl-search.ts && python -c \"import json; d=json.load(open('data/datasets/raw/gold_examples.json')); assert any('papers by kelbert' in e['nl'] for e in d)\"",
      "notes": "Fixed with post-processing in API route. Added 10 training examples for lastname-only queries. See beads: nls-finetune-scix-3gw"
    },
    {
      "id": "eval-005",
      "name": "Model quality - consistent field selection (title vs abs)",
      "category": "eval",
      "status": "passing",
      "verification": "grep -q 'normalizeTitleToAbs\\|expandAbbreviations' ~/ads-dev/nectar/src/pages/api/nl-search.ts && python -c \"import json; d=json.load(open('data/datasets/raw/gold_examples.json')); assert any('papers about machine learning' in e['nl'] for e in d)\"",
      "notes": "Fixed with post-processing (title:→abs:, abbreviation expansion) and 15 training examples. See beads: nls-finetune-scix-6kk"
    },
    {
      "id": "integ-009",
      "name": "Multiple query suggestions (3-5 alternatives)",
      "category": "integration",
      "status": "passing",
      "verification": "curl -s http://localhost:8000/api/nl-search -X POST -H 'Content-Type: application/json' -d '{\"query\":\"exoplanets\"}' | jq '.queries | length > 1'",
      "notes": "Returns 3-5 query variations via post-processing. UI displays radio buttons for selection."
    },
    {
      "id": "research-001",
      "name": "Research: embeddings for query expansion + DB constraints",
      "category": "research",
      "status": "passing",
      "verification": "test -f docs/research/query-expansion.md",
      "notes": "Research complete. Recommend ADS autocomplete for author validation with 200ms timeout."
    },
    {
      "id": "data-005",
      "name": "Second-order operator training examples added",
      "category": "data",
      "status": "passing",
      "verification": "python -c \"import json; d=json.load(open('data/datasets/raw/gold_examples.json')); ops=[e for e in d if e.get('category')=='operator']; assert len(ops)>=50, f'Only {len(ops)} operator examples'\"",
      "notes": "Added 56 examples for trending(), similar(), useful(), reviews(), citations(), references(), topn(), NEAR, NOT, OR, property:, data:"
    },
    {
      "id": "data-006",
      "name": "Training JSONL regenerated with operator examples",
      "category": "data",
      "status": "passing",
      "verification": "python -c \"import json; lines=open('data/datasets/processed/train.jsonl').readlines(); assert any('trending(' in l for l in lines), 'No trending() in training data'\"",
      "notes": "Regenerated: 2531 pairs total, 50 operator examples"
    },
    {
      "id": "train-002",
      "name": "Model retrained with operator-aware data",
      "category": "modal",
      "status": "passing",
      "verification": "curl -s 'http://localhost:8000/api/nl-search' -X POST -H 'Content-Type: application/json' -d '{\"query\":\"trending papers on exoplanets\"}' | grep -q 'trending'",
      "notes": "Training completed (operators-v2). Post-processing removed - model must learn natively via train-003."
    },
    {
      "id": "eval-006",
      "name": "Operator query generation verified",
      "category": "eval",
      "status": "passing",
      "verification": "curl -s -X POST https://sjarmak--nls-finetune-serve-vllm-serve.modal.run/v1/chat/completions -H 'Content-Type: application/json' -d '{\"model\":\"llm\",\"messages\":[{\"role\":\"system\",\"content\":\"Convert natural language to ADS search query. Output JSON: {\\\"query\\\": \\\"...\\\"}\"},{\"role\":\"user\",\"content\":\"Query: papers similar to 2019ApJ...887L...1K\"}],\"max_tokens\":64}' | grep -q 'similar'",
      "notes": "Verified with operators-v3 model. All operator types generate correctly."
    },
    {
      "id": "data-007",
      "name": "Operator examples expanded to 10%+ coverage",
      "category": "data",
      "status": "passing",
      "verification": "python -c \"import json; d=json.load(open('data/datasets/raw/gold_examples.json')); ops=[e for e in d if e.get('category')=='operator']; assert len(ops)>=100, f'Only {len(ops)} operator examples'\"",
      "notes": "Added 84 new examples. Total: 134 operator examples covering citations, reviews, useful, similar, trending, references, topn, NOT, OR, NEAR"
    },
    {
      "id": "data-008",
      "name": "Training data regenerated with expanded operators",
      "category": "data",
      "status": "passing",
      "verification": "python -c \"import json; lines=open('data/datasets/processed/train.jsonl').readlines(); ops=sum(1 for l in lines if any(op in l for op in ['trending(', 'citations(', 'similar(', 'useful(', 'reviews(', 'references(', 'topn('])); pct=ops/len(lines)*100; print(f'Operators: {ops}/{len(lines)} = {pct:.1f}%'); assert pct>=5, f'Only {pct:.1f}% operators'\"",
      "notes": "Regenerated with 2376 training examples (307 gold). 5.1% operator coverage (120 examples)."
    },
    {
      "id": "train-003",
      "name": "Model retrained with expanded operator data",
      "category": "modal",
      "status": "passing",
      "verification": "curl -s -X POST https://sjarmak--nls-finetune-serve-vllm-serve.modal.run/v1/chat/completions -H 'Content-Type: application/json' -d '{\"model\":\"llm\",\"messages\":[{\"role\":\"system\",\"content\":\"Convert natural language to ADS search query. Output JSON: {\\\"query\\\": \\\"...\\\"}\"},{\"role\":\"user\",\"content\":\"Query: trending papers on cosmology\"}],\"max_tokens\":64}' | grep -q 'trending('",
      "notes": "Training completed (operators-v3, 93.8% token accuracy). Model generates operators natively."
    },
    {
      "id": "integ-010",
      "name": "ADS autocomplete for author validation",
      "category": "integration",
      "status": "passing",
      "verification": "grep -r 'autocomplete' ~/ads-dev/nectar/src/pages/api/",
      "notes": "Implemented with 200ms timeout, 1-hour cache, canonical name replacement"
    },
    {
      "id": "integ-011",
      "name": "Semantic query expansion with synonym table",
      "category": "integration",
      "status": "failing",
      "verification": "grep -r 'SYNONYM\\|expandSynonyms' ~/ads-dev/nectar/src/",
      "notes": "From research-001: Pre-computed table for astronomy terms (planet formation -> protoplanetary disk)"
    },
    {
      "id": "integ-012",
      "name": "Object name resolution via SIMBAD/NED",
      "category": "integration",
      "status": "failing",
      "verification": "grep -r 'SIMBAD\\|resolveObject' ~/ads-dev/nectar/src/",
      "notes": "Stretch goal: Resolve M31 -> Andromeda, NGC 224"
    }
  ]
}
